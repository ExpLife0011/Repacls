<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Repacls by NoMoreFood</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Repacls</h1>
        <p class="header">Windows File Security Utility</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/NoMoreFood/Repacls/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/NoMoreFood/Repacls/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/NoMoreFood/Repacls">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/NoMoreFood">NoMoreFood</a></p>


      </header>
      <section>
        <h1>
<a id="repacls-usage-information" class="anchor" href="#repacls-usage-information" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Repacls Usage Information</h1>

<p>Link To Latest Binaries: <a href="https://github.com/NoMoreFood/Repacls/files/372649/Repacls.Binaries.-.v1.0.0.2.zip">Here</a></p>

<p><code>repacls.exe /Path &lt;Absolute Path&gt; ... other options ....</code></p>

<p><code>Repacls was developed to address large scale migrations, transitions, health</code>
<code>checks, and access control optimizations.  Repacls is multi-threaded and</code>
<code>employs account name caching to accelerate operation on large file servers</code>
<code>with millions of files.  It was developed to address a variety of platform</code>
<code>limitations, resource consumption concerns, and bugs within xcacls, icacls,</code>
<code>setacl, and subinacl.</code></p>

<p><code>Repacls must be executed with administrator permissions and will attempt to</code>
<code>acquire the backup, restore, and take ownership privileges during its</code>
<code>execution.</code></p>

<p><code>Any command line parameter that accepts an account or domain name can also use</code>
<code>a SID string instead of the name.  This may be necessary if working with an</code>
<code>account or domain that is no longer resolvable.</code></p>

<p><code>Global Options</code>
<code>==============</code>
<code>Global Options affect the entire command regardless of where they appear in the</code>
<code>passed command line.  It is recommended to include them at the very beginning</code>
<code>or end of your command as to not confuse them with ordered parameters.</code></p>

<p><code>/Path</code>
   <code>Specifies the file or directory to process.  If a directory, the directory</code>
   <code>is processed recursively; all operations specified affect the directory</code>
   <code>and all files and folders under the directory (unless otherwise specified).</code>
   <code>This parameter is mandatory.</code></p>

<p><code>/Quiet</code>
   <code>Hides all non-error output. This option will greatly enhance performance if</code>
   <code>a large number of changes are being processed.  Alternatively, it is</code>
   <code>advisable to redirect console output to a file (using the &gt; redirector) if</code>
  <code>/Quiet cannot be specified.</code></p>

<p><code>/Threads &lt;NumberOfThreads&gt;</code>
   <code>Specifies the number of threads to use while processing.  The default value</code>
   <code>of  '5' is usually adequate, but can be increased if performing changes</code>
   <code>over a higher-latency connection.  Since changes to a parent directory</code>
   <code>often affect the inherited security on children, the security of children</code>
   <code>objects are always processed after the the security on their parent objects</code>
   <code>are fully processed.</code></p>

<p><code>/WhatIf</code>
   <code>This option will analyze security and report on any potential changes</code>
   <code>without actually committing the data.  Use of /WhatIf is recommended for</code>
   <code>those first using the tool.</code></p>

<p><code>/NoHiddenSystem</code>
   <code>Use this option to avoid processing any file marked as both 'hidden' and</code>
   <code>'system'.  These are what Windows refers to 'operating system protected</code>
   <code>files' in Windows Explorer.</code></p>

<p><code>Ordered Options</code>
<code>===============</code>
<code>Ordered Options are executed on each SID encountered in the security descriptor</code>
<code>in the order they are specified on the command line.  Executing commands in this</code>
<code>way is preferable to multiple commands because the security descriptor is only</code>
<code>read and written once for the entire command which is especially</code>
<code>helpful for large volumes.</code></p>

<p><code>Commands That Do Not Alter Security</code>
<code>-----------------------------------</code>
<code>/PrintDescriptor</code>
   <code>Prints out the security descriptor to the screen.  This is somewhat useful</code>
   <code>for  seeing the under-the-cover changes to the security descriptor before</code>
   <code>and after a particular command.</code></p>

<p><code>/CheckCanonical</code>
   <code>This command inspects the DACL and SACL for canonical order compliance</code>
   <code>(i.e., the rules in the ACL are ordered as explicity deny, explicity allow,</code>
   <code>inherited deny, inherited allow).  If non-canonical entries are detected,</code>
   <code>it is recommended to inspect the ACL with icacls.exe or Windows Explorer</code>
   <code>to ensure the ACL is not corrupted in a more significant way.</code></p>

<p><code>/ExportDescriptor &lt;FileName&gt;</code>
   <code>Export the security descriptor to the file specified.  The file is</code>
   <code>outputted in the format of file|descriptor on each line.  The security</code>
   <code>descriptor is formated as specified in the documentation for</code>
   <code>ConvertSecurityDescriptorToStringSecurityDescriptor().</code></p>

<p><code>/FindAccount &lt;Name|Sid&gt;</code>
   <code>Reports any instance of an account specified.</code></p>

<p><code>/FindDomain &lt;Name|Sid&gt;</code>
   <code>Reports any instance of an account matching the specified domain.</code></p>

<p><code>Commands That Can Alter Security (When /WhatIf Is Not Present)</code>
<code>--------------------------------</code>
<code>/Compact</code>
   <code>This command will look for mergable entires in the security descriptor and</code>
   <code>merge them.  For example, running icacls.exe &lt;file&gt; /grant Everyone:R</code>
   <code>followed by icacls.exe &lt;file&gt; /grant Everyone:(CI)(OI)(R) will produce</code>
   <code>two entries even those the second command supersedes the first one.</code>
   <code>Windows Explorer automatically merges these entries when display security</code>
   <code>information so you have to use other utilities to detect these</code>
   <code>inefficiencies.  While these's nothing inheritance wrong with these</code>
   <code>entires, it possible for them to result file system is performance</code>
   <code>degradation.  Replace will automatically run compact ACL that needs to</code>
   <code>be modified; this option is used to unconditionally look for and</code>
   <code>modify ACLs that would otherwise not need to be modified.</code></p>

<p><code>/MigrateDomain &lt;SourceDomainName|Sid&gt;:&lt;TargetDomainName|Sid&gt;</code>
    <code>This command will look to see whether any account in &lt;SourceDomain&gt;</code>
    <code>has an identially-named account in &lt;TargetDomain&gt;.  If so, any entires</code>
     <code>are converted to use the new domain.  For example,</code>
    <code>'OldDomain\Domain Admins' would become 'NewDomain\Domain Admins'.  Since</code>
    <code>this operation relies on the names being resolvable, specifying a SID</code>
    <code>instead of domain name for this command does not work.</code></p>

<p><code>/RemoveAccount &lt;Name|Sid&gt;</code>
    <code>Will remove &lt;Name&gt; from the security descriptor.  If the specified name</code>
    <code>is found as the file owner, the owner is replaced by the builtin</code>
    <code>Administrators group.  If the specified name is found as the group owner</code>
    <code>(a defunct attribute that has no function in terms of security), it is</code>
    <code>also replace with the built-in Administrators group.</code></p>

<p><code>/RemoveOrphans &lt;Domain|Sid&gt;</code>
   <code>Remove any account whose SID is derived from the &lt;Domain&gt; specified</code>
   <code>and can no longer be resolved to a valid name.  Instead of &lt;Domain&gt;,</code>
   <code>you can pass '!FORCE!' to remove all orphaned SIDs but this should be</code>
   <code>used under extreme caution since any SID that cannot be resolved to</code>
   <code>a name will be removed.  For example, SID that maps to a local group</code>
   <code>on a remote server may not be queryable for group names and therefore</code>
   <code>may be recognized as orphaned even though they are not.</code></p>

<p><code>/RemoveRedundant</code>
   <code>This command will remove any explicit permission that is redundant of</code>
   <code>of the permissions its already given through inheritance.  This option</code>
   <code>helps recovered from the many indivual explicit permissions that may</code>
   <code>have been littered from the old cacls.exe command that didn't</code>
   <code>understand how to set up inheritance.</code></p>

<p><code>/ReplaceAccount &lt;SearchAccount&gt; &lt;ReplaceAccount&gt;</code>
   <code>Search for an account and replace it with another account.</code></p>

<p><code>/SetOwner &lt;Name|Sid&gt;</code>
   <code>Will set the owner of the file to the name specified.</code></p>

<p><code>/SidHistoryFix</code>
   <code>Will convert any instances of old SIDs present in the security descriptor</code>
   <code>to there to active SID currently associated with the account.  This is</code>
   <code>especially useful after a domain migration and prior to removing</code>
   <code>excess SID history on accounts.</code></p>

<p><code>Exclusive Options</code>
<code>=================</code>
<code>/Help or /? or /H</code>
   <code>Shows this information.</code></p>

<p><code>/ResetChildren</code>
   <code>This will reset all children of path to the to inherit from the parant.  It</code>
   <code>will not affect the security of the parent.  This command does not affect</code>
   <code>the security the root directory as specified by the /Path argument.</code></p>

<p><code>/InheritChildren</code>
   <code>This will cause any parent that is currently set to block inheritance to</code>
   <code>start allowing inheritance.  Any explicit entries on the children are</code>
   <code>preserved.  This command does not will not affect the security the root</code>
   <code>directory as specified by the /Path argument.</code></p>

<p><code>Other Notes &amp; Limitations</code>
<code>=========================</code>
<code>To only affect a particular part of a security descriptor, you can add on an</code>
<code>optional ':X' parameter after the end of the account name where X is a comma</code>
<code>separated list of DACL,SACL, OWNER, or GROUP.  For example,</code>
<code>'/RemoveAccount "DOM\joe:DACL,OWNER"' will only cause the designated account</code>
<code>to be removed from the DACL and OWNER parts of the security descriptor.</code></p>

<p><code>Examples</code>
<code>========</code>
<code>- Replace all instances of DOM\jack to DOM\jill in C:\test:</code>
  <code>repacls.exe /Path C:\Test /ReplaceAccount "DOM\jack:DOM\jill"</code></p>

<p><code>- Migrate all permissions for all accounts with matching</code>
  <code>names in DOMA with DOMB:</code>
  <code>repacls.exe /Path C:\Test /MigrateDomain DOMA:DOMB</code></p>

<p><code>- Update old SID references, remove any explicit permissions that are already</code>
  <code>granted by inherited permissions, and compact all ACLs if not compacted:</code>
  <code>repacls.exe /Path C:\Test /SidHistoryFix /RemoveRedundant /Compact</code></p>

<p><code>Type 'repacls.exe /? | more' to scroll this documentation.</code></p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
